<div class="container" id="product-page">
  <div class="row">
    <!-- left side -->
    <div class="col-md-6" id="product-left">

      <h1 class="prod-title"><%= @product.name %></h1>
      <div class="prod-image">
        <%= image_tag @product.image1, class: "img-responsive" %>
      </div>

      <div class="prod-desc">
        <%= @product.description %>
      </div>

      <div class="prod-pork-beef">

        <% if @product.has_pork %>
          <div class="contains">Contains Pork</div>
        <% end %>

        <% if @product.has_beef %>
          <div class="contains">Contains Beef</div>
        <% end %>

      </div>

    </div>

    <!-- right side -->
    <div class="col-md-6" id="product-right">

      <div class="prod-price"><%=number_to_currency(@product.price, unit: "RM")%></div>
      <div class="prod-time-left"><% if @product.expire < DateTime.now %> EXPIRED <% end %></div>

      <% if @product.expire > DateTime.now %>
      <script type="text/javascript">
        $(".prod-time-left")
        .countdown("<%= @product.expire.strftime("%Y/%m/%d %H:%M:%S") %>", function(event) {
          $(this).text(
            event.strftime('%D days %H:%M:%S')
          );
        });
      </script>
      <% end %>

      <div class="prod-product-left">
        <% if @product.expire < DateTime.now %>
          SOLD OUT
        <% else %>
          <%= @total_left %> left, out of <%= @product.pax_total %> meals
        <% end %>
      </div>
      <div class="prod-location">
        <div class="prod-map">
          <img width="550" src="http://maps.googleapis.com/maps/api/staticmap?center=cyberjaya&zoom=18&scale=false&size=550x240&maptype=roadmap&key=AIzaSyCvufbqzO_iNDmBMY4VV-3h_-Xj53r7uMg&format=png&visual_refresh=true" alt="Google Map of cyberjaya">
        </div>

        <div class="prod-address">
          <%= @product.location %>
        </div>
      </div>
      <div class="prod-collect"><span>Collection Date:</span> <%= @product.collect.strftime("%d/%m/%Y") %></div>
      <div class="prod-collect"><span>Collection Time:</span> <%= @product.collect.strftime("%l:%M%p") %></div>

      <%if current_user != @product.user%>
        <% if @product.expire > DateTime.now %>
          <% if current_user != nil %>
            <div id="order-form">
              <%= form_for(@order, url: orders_path, method: :post, html: { id: "add-product-form" }) do |f| %>

              <%= f.number_field :product_id, required: true, value:"#{@product.id}", style: "display:none;" %>

                <div class="field">
                  <%= f.label "Quantity :" %><br />
                  <%= f.number_field :quantity, autofocus: true, min: 1, value: 1, required: true %>
                </div>

                <div class="field">
                  <%= f.label "Phone :" %><br />
                  <%= f.phone_field :phone, autofocus: true, placeholder: "Phone", value:"#{current_user.try(:phone)}" %>
                </div>

                <div class="field">
                  <%= f.label "Email :" %><br />
                  <%= f.email_field :email, autofocus: true, placeholder: "Email", value:"#{current_user.try(:email)}" %>
                </div>

                <div class="field">
                  <%= f.label "Address :" %><br />
                  <%= f.text_field :address, autofocus: true, placeholder: "Address", value:"#{current_user.try(:address)}" %>
                </div>

                <button class="btn btn-embossed btn-beige prod-order-btn" type="submit" id="checkout-btn"><span class="glyphicon glyphicon-send" aria-hidden="true"></span> Check Out</button>
              <% end %>
            </div>
          <% end %>
          <button class="btn btn-embossed btn-beige prod-order-btn" type="submit" id="order-btn"><span class="glyphicon glyphicon-send" aria-hidden="true"></span> Order Now</button>
          <script>
          $( document ).ready(function() {
            $('#order-btn').click(function(){
              <% if current_user != nil %>
                $(this).slideUp();
                $("#order-form").slideDown();
              <% else %>
                window.location.href = "<%=new_user_session_path%>";
              <% end %>


            })
          });
          </script>
        <% end %>
      <% end %>
    </div>

  </div>

  <div class="row">
    <div class="col-md-6" id="about-chef">
      <hr />
      <div class="chef-profile">
        <% if @product.user.profile_image? %>
          <%= image_tag @product.user.profile_image, class: "profile-img img-responsive" %>
        <% end %>
      </div>

      <div class="chef-store">
        <h3><strong><%= @product.user.store_name %></strong></h3>
        <h4>by <strong><%= link_to @product.user.name, user_path(@product.user) %></strong></h4>
      </div>

      <div id="info-con">
        <div class="info-title">About Chef</div>
        <div class="info-desc"><%= @product.user.about %></div>

        <div class="info-title">Chef's Rating</div>
        <div class="info-desc">@@@@@</div>

        <%if current_user != @product.user%>
          <%if current_user%>
            <div>
              <%= link_to follow_path(chef_id: @product.user.id), method: :post, remote: true, class: "btn #{@class} btn-block", id:"follow-btn" do %>
                <span class="glyphicon glyphicon-heart" aria-hidden="true"></span> <span class="btn-text"><%= @text %></span>
              <% end %>
            </div>
          <% else %>
            <div>
              <%= link_to new_user_session_path, class: "btn btn-success btn-block", id:"follow-btn" do %>
                <span class="glyphicon glyphicon-heart" aria-hidden="true"></span> <span class="btn-text">Follow Chef</span>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
